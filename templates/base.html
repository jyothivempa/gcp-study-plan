{% load static %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth"> <!-- Removed 'dark' class -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}GCPMastery: Zero to Hero{% endblock %}</title>
    <meta name="description"
        content="{% block meta_description %}The ultimate 45-day hands-on study plan to master Google Cloud Platform (GCP). Built for beginners, focused on the Associate Cloud Engineer certification.{% endblock %}">

    <!-- Fonts: Outfit (Headings) + Inter (Body) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@500;700;800&family=JetBrains+Mono:wght@400;600&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        // Stripe-inspired "Modern Technical" Palette
                        slate: {
                            50: '#f6f9fc', // Stripe Light Gray BG
                            100: '#e3e8ee',
                            200: '#cdd5df',
                            300: '#9aa5b1',
                            400: '#697386',
                            500: '#4f566b', // Muted Text
                            600: '#3c4257', // Body Text (Stripe Slate)
                            700: '#2a2f45',
                            800: '#1a1f36', // Dark Navy (Headings)
                            900: '#0a2540', // Deep Brand Navy
                            950: '#000000',
                        },
                        brand: {
                            50: '#f2f5ff',
                            100: '#e0e8ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#635bff', // Stripe Blurple (Primary)
                            600: '#5851d8',
                            700: '#4c44b6',
                            800: '#3e3794',
                            900: '#342e73',
                            950: '#211d4d',
                        },
                        dark: {
                            bg: '#f6f9fc', // Mapped to Light Gray for fallback
                            card: '#ffffff',
                            border: '#e3e8ee',
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'blob': 'blob 7s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        }
                    },
                    typography: (theme) => ({
                        DEFAULT: {
                            css: {
                                maxWidth: 'none',
                                color: theme('colors.slate.600'),
                                h1: { fontFamily: 'Outfit', fontWeight: '800', color: theme('colors.slate.900') },
                                h2: { fontFamily: 'Outfit', fontWeight: '700', color: theme('colors.slate.900'), marginTop: '2em' },
                                h3: { fontFamily: 'Outfit', fontWeight: '600', color: theme('colors.slate.900') },
                                code: { color: theme('colors.pink.500'), backgroundColor: theme('colors.slate.100'), padding: '0.2em 0.4em', borderRadius: '0.25rem', fontWeight: '600' },
                                'code::before': { content: '""' },
                                'code::after': { content: '""' },
                            }
                        },
                        dark: {
                            css: {
                                color: theme('colors.slate.300'),
                                h1: { color: theme('colors.white') },
                                h2: { color: theme('colors.white') },
                                h3: { color: theme('colors.white') },
                                strong: { color: theme('colors.white') },
                                code: { color: theme('colors.pink.400'), backgroundColor: theme('colors.slate.800') },
                                'a': { color: theme('colors.brand.400') },
                                blockquote: { color: theme('colors.slate.300'), borderLeftColor: theme('colors.brand.500') },
                            }
                        }
                    })
                }
            },
            plugins: [
                function ({ addVariant, e }) {
                    addVariant('dark-prose', ({ modifySelectors, separator }) => {
                        modifySelectors(({ className }) => {
                            return `.dark .${e(`dark-prose${separator}${className}`)}`
                        })
                    })
                }
            ]
        }
    </script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Glassmorphism Utilities */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .dark .glass {
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
        }

        .dark .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>

<body
    class="bg-slate-50 text-slate-900 dark:bg-dark-bg dark:text-slate-100 font-sans antialiased h-screen flex flex-col overflow-hidden transition-colors duration-300">

    <!-- ðŸŒŸ ANIMATED BACKGROUND (Dark Mode Optimized) -->
    <div class="fixed inset-0 z-0 pointer-events-none overflow-hidden">
        <!-- Light Mode Blobs -->
        <div
            class="absolute top-0 left-0 w-96 h-96 bg-brand-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob dark:hidden">
        </div>
        <div
            class="absolute top-0 right-0 w-96 h-96 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000 dark:hidden">
        </div>
        <div
            class="absolute -bottom-8 left-20 w-96 h-96 bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000 dark:hidden">
        </div>

        <!-- Dark Mode Blobs (Subtle Glows) -->
        <div
            class="hidden dark:block absolute top-[10%] left-[20%] w-96 h-96 bg-brand-900/40 rounded-full blur-[100px] animate-pulse-slow">
        </div>
        <div
            class="hidden dark:block absolute bottom-[10%] right-[10%] w-[500px] h-[500px] bg-indigo-900/30 rounded-full blur-[120px]">
        </div>
    </div>

    <!-- ðŸŸ¢ NAVBAR -->
    {% block navbar %}
    <nav class="h-16 flex-none z-40 transition-all duration-300 glass border-b border-slate-200 dark:border-white/5">
        <div class="h-full px-4 lg:px-6 flex items-center justify-between max-w-7xl mx-auto w-full">

            <!-- Logo -->
            <a href="{% url 'home' %}" class="flex items-center gap-2 group">
                <div class="relative w-8 h-8 flex items-center justify-center">
                    <div
                        class="absolute inset-0 bg-brand-500 rounded-lg rotate-3 group-hover:rotate-6 transition-transform opacity-20 dark:opacity-40">
                    </div>
                    <div
                        class="relative w-8 h-8 bg-gradient-to-br from-brand-500 to-indigo-600 text-white rounded-lg flex items-center justify-center font-bold text-lg shadow-lg">
                        <i class="fa-brands fa-google"></i>
                    </div>
                </div>
                <div class="flex flex-col">
                    <span
                        class="text-lg font-display font-black tracking-tight text-slate-900 dark:text-white leading-none">
                        GCP<span class="text-brand-600 dark:text-brand-400">Mastery</span>
                    </span>
                    <span
                        class="text-[10px] font-bold uppercase tracking-widest text-slate-400 dark:text-slate-500">Zero
                        to Hero</span>
                </div>
            </a>

            <!-- Center Search (Desktop) -->
            <div class="hidden md:block flex-1 max-w-md mx-8">
                <form action="{% url 'search_lessons' %}" method="get" class="relative group">
                    <input type="text" name="q" placeholder="Search lessons..."
                        class="w-full bg-slate-100/50 dark:bg-slate-800/50 border border-slate-200 dark:border-white/10 rounded-full py-2 pl-10 pr-4 text-sm focus:bg-white dark:focus:bg-slate-800 transition-all outline-none focus:ring-2 focus:ring-brand-500/50">
                    <i class="fa-solid fa-magnifying-glass absolute left-3.5 top-3 text-slate-400"></i>
                </form>
            </div>

            <!-- Right Actions -->
            <div class="flex items-center gap-4">

                <!-- Links -->
                <div class="hidden lg:flex items-center gap-1 text-sm font-semibold text-slate-600 dark:text-slate-300">
                    <a href="{% url 'curriculum_overview' %}"
                        class="px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-white/5 transition">Curriculum</a>
                    <a href="{% url 'roadmap' %}"
                        class="px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-white/5 transition">Roadmap</a>
                </div>

                <!-- Theme Toggle -->
                <!-- Theme Toggle REMOVED (Forced Dark Mode) -->

                <!-- Divider -->
                <div class="h-6 w-px bg-slate-200 dark:bg-white/10 hidden sm:block"></div>

                <!-- Auth User -->
                {% if user.is_authenticated %}
                <div class="flex items-center gap-3">
                    <!-- XP Pill -->
                    <div
                        class="hidden sm:flex items-center gap-2 px-3 py-1 bg-brand-50 dark:bg-brand-900/30 text-brand-700 dark:text-brand-300 rounded-full border border-brand-100 dark:border-brand-500/20 text-xs font-bold">
                        <i class="fa-solid fa-bolt"></i> {{ user.profile.xp }} XP
                    </div>

                    <div class="relative group">
                        <div
                            class="w-9 h-9 bg-gradient-to-br from-slate-200 to-slate-300 dark:from-slate-700 dark:to-slate-600 rounded-full flex items-center justify-center font-bold text-slate-700 dark:text-white border-2 border-white dark:border-slate-800 shadow-sm cursor-pointer">
                            {{ user.username|first|upper }}
                        </div>
                        <!-- Dropdown (Simple) -->
                        <div
                            class="absolute right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-100 dark:border-white/10 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all transform origin-top-right z-50">
                            <div class="px-4 py-3 border-b border-slate-100 dark:border-white/5">
                                <p class="text-sm font-bold text-slate-900 dark:text-white">{{ user.username }}</p>
                                <p class="text-xs text-slate-500 dark:text-slate-400">Level {{ user.profile.level }}</p>
                            </div>
                            <form method="post" action="{% url 'logout' %}">
                                {% csrf_token %}
                                <button type="submit"
                                    class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 transition rounded-b-xl font-bold">
                                    Log Out
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                {% else %}
                <a href="{% url 'login' %}"
                    class="text-sm font-bold hover:text-brand-600 dark:text-slate-300 dark:hover:text-white">Log In</a>
                <a href="{% url 'register' %}"
                    class="px-4 py-2 bg-slate-900 dark:bg-white dark:text-slate-900 text-white rounded-lg text-sm font-bold hover:scale-105 transition-transform shadow-lg shadow-brand-500/20">Get
                    Started</a>
                {% endif %}
            </div>
        </div>
    </nav>
    {% endblock %}

    <!-- ðŸŸ¢ MAIN CONTENT -->
    <div class="flex-1 flex flex-col overflow-hidden relative">
        <div class="flex-1 overflow-y-auto custom-scrollbar">
            {% block content %}{% endblock %}

            <!-- Footer -->
            <footer
                class="border-t border-slate-200 dark:border-white/5 bg-white/50 dark:bg-slate-900/50 backdrop-blur-sm mt-auto">
                <div class="max-w-7xl mx-auto py-8 px-4 text-center">
                    <p class="text-slate-500 dark:text-slate-400 text-sm font-medium">
                        &copy; {% now "Y" %} GCPMastery. Built with <i
                            class="fa-solid fa-heart text-red-500 animate-pulse"></i> by Antigravity.
                    </p>
                </div>
            </footer>
        </div>
    </div>

    <!-- Mermaid -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
    </script>

    {% block extra_js %}{% endblock %}
</body>

</html>