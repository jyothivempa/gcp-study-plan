{% extends 'base.html' %}
{% load static %}

{% block title %}{{ course.title }} - Dashboard{% endblock %}

{% block content %}
<div class="flex-1 overflow-y-auto relative z-10 custom-scrollbar pb-20">

    <!-- HERO SECTION -->
    <div class="relative bg-white/50 backdrop-blur-sm border-b border-slate-200/50 pt-8 pb-12 mb-12">
        <div class="max-w-7xl mx-auto px-4 lg:px-8">
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-8">

                <!-- Course Info -->
                <div class="flex items-center gap-6">
                    <div
                        class="w-20 h-20 rounded-2xl bg-gradient-to-br from-brand-500 to-brand-600 text-white flex items-center justify-center text-4xl shadow-xl shadow-brand-500/20 animate-fade-in-up">
                        <i class="{{ course.icon_class }}"></i>
                    </div>
                    <div class="animate-fade-in-up" style="animation-delay: 0.1s;">
                        <div class="flex items-center gap-3 mb-1">
                            <span
                                class="px-2.5 py-0.5 rounded-full bg-brand-50 text-brand-600 border border-brand-100/50 text-[10px] font-bold uppercase tracking-widest">
                                Interactive Course
                            </span>
                            {% if user_progress_percentage == 100 %}
                            <span
                                class="px-2.5 py-0.5 rounded-full bg-green-50 text-green-600 border border-green-100/50 text-[10px] font-bold uppercase tracking-widest">
                                <i class="fa-solid fa-medal mr-1"></i> Completed
                            </span>
                            {% endif %}
                        </div>
                        <h1 class="text-4xl font-display font-bold text-slate-900 leading-tight">
                            {{ course.title }}
                        </h1>
                        <p class="text-slate-500 font-medium mt-1 text-lg">{{ course.description }}</p>
                    </div>
                </div>

                <!-- Progress Stats -->
                {% if user.is_authenticated %}
                <div class="w-full md:w-auto bg-white/60 backdrop-blur-md rounded-2xl p-6 border border-white/50 shadow-lg shadow-slate-200/50 animate-fade-in-up"
                    style="animation-delay: 0.2s;">
                    <div class="flex items-center justify-between gap-8 mb-3">
                        <div>
                            <div class="text-xs font-bold text-slate-400 uppercase tracking-widest">Progress</div>
                            <div class="text-3xl font-display font-bold text-slate-900">{{ user_progress_percentage }}%
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs font-bold text-slate-400 uppercase tracking-widest">Completed</div>
                            <div class="text-lg font-bold text-brand-600">{{ completed_day_ids|length }} <span
                                    class="text-slate-400 text-sm">/ {{ weeks|length|default:'30+' }} Days</span></div>
                        </div>
                    </div>
                    <!-- Progress Bar -->
                    <div class="w-full md:w-64 h-3 bg-slate-100 rounded-full overflow-hidden shadow-inner">
                        <div class="h-full bg-gradient-to-r from-brand-400 to-brand-600 rounded-full relative overflow-hidden transition-all duration-1000 ease-out"
                            style="width: {{ user_progress_percentage }}%">
                            <div class="absolute inset-0 bg-white/20 animate-pulse-slow"></div>
                        </div>
                    </div>
                </div>
                {% else %}
                <a href="{% url 'login' %}"
                    class="group relative px-8 py-4 bg-brand-600 text-white rounded-xl font-bold hover:shadow-xl hover:shadow-brand-500/30 hover:-translate-y-1 transition-all duration-300 overflow-hidden">
                    <div
                        class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300">
                    </div>
                    <span class="relative flex items-center gap-2">
                        Start Learning Now <i
                            class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                    </span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- MAIN GRID -->
    <div class="max-w-7xl mx-auto px-4 lg:px-8">

        <!-- Continue Learning / Resume Card (If logged in and in progress) -->
        {% if user.is_authenticated and user_progress_percentage > 0 and user_progress_percentage < 100 %} <!-- Logic to
            find next uncompleted day could go here, for now simpler link -->
            {% endif %}

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {% for week in weeks %}
                <div class="group relative bg-white/40 backdrop-blur-md rounded-3xl border border-white/60 p-1 hover:bg-white/60 transition-all duration-500 hover:shadow-2xl hover:shadow-brand-900/5 hover:-translate-y-1 animate-fade-in-up"
                    style="animation-delay: {{ forloop.counter|add:2 }}00ms;">

                    <!-- Week Card Inner -->
                    <div
                        class="h-full bg-gradient-to-br from-white/80 to-white/40 rounded-[20px] p-6 lg:p-8 flex flex-col relative overflow-hidden">

                        <!-- Decorative BG Blob -->
                        <div
                            class="absolute -top-20 -right-20 w-48 h-48 bg-gradient-to-br from-brand-100/30 to-indigo-100/30 rounded-full blur-3xl group-hover:scale-150 transition-transform duration-700">
                        </div>

                        <!-- Header -->
                        <div class="relative z-10 mb-6">
                            <div class="flex items-center justify-between mb-3">
                                <span
                                    class="px-3 py-1 rounded-lg bg-slate-100/80 text-slate-500 text-[10px] font-black uppercase tracking-widest border border-slate-200/50 group-hover:bg-brand-50 group-hover:text-brand-600 group-hover:border-brand-100/50 transition-colors">
                                    Module {{ week.number }}
                                </span>
                                {% if week.number == 1 %}
                                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                                {% endif %}
                            </div>
                            <!-- Time Estimate Badge -->
                            <div class="mt-2 text-xs font-medium text-slate-400 flex items-center gap-2">
                                <i class="fa-regular fa-clock"></i>
                                <span>~ {{ week.days.count|add:2 }} Hours</span>
                            </div>
                            <h3
                                class="text-xl font-display font-bold text-slate-800 leading-snug group-hover:text-brand-700 transition-colors mt-2">
                                {{ week.description }}
                            </h3>
                        </div>

                        <!-- Days List (Syllabus) -->
                        <div class="relative z-10 space-y-3 mb-8 flex-1">
                            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Syllabus</p>
                            {% for day in week.days.all %}
                            <div
                                class="flex items-center gap-3 text-sm text-slate-600 group-hover:text-slate-700 transition-colors border-b border-slate-50 pb-2 last:border-0 last:pb-0">
                                <div
                                    class="w-6 h-6 rounded flex items-center justify-center shrink-0 
                                {% if day.id in completed_day_ids %}bg-green-100 text-green-600{% else %}bg-slate-100 text-slate-400{% endif %}">
                                    {% if day.id in completed_day_ids %}
                                    <i class="fa-solid fa-check text-[10px]"></i>
                                    {% else %}
                                    <span class="text-[10px] font-bold">{{ day.number }}</span>
                                    {% endif %}
                                </div>
                                <span class="truncate">{{ day.title }}</span>
                            </div>
                            {% endfor %}
                        </div>

                        <!-- Footer Action -->
                        <a href="{% url 'lesson_detail' course.slug week.days.first.number %}"
                            class="relative z-10 mt-auto w-full py-3 rounded-xl bg-slate-50 border border-slate-200 text-slate-600 font-bold text-sm flex items-center justify-center gap-2 group-hover:bg-brand-600 group-hover:text-white group-hover:border-brand-500 transition-all duration-300">
                            <span>Start Module</span>
                            <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                        </a>
                    </div>
                </div>
                {% endfor %}

                <!-- Coming Soon Card (Placeholder/Upsell) -->
                <div
                    class="group relative bg-white/20 backdrop-blur-sm rounded-3xl border border-white/40 p-1 opacity-60 hover:opacity-100 transition-opacity duration-300 border-dashed">
                    <div
                        class="h-full rounded-[20px] p-8 flex flex-col items-center justify-center text-center min-h-[300px]">
                        <div
                            class="w-16 h-16 rounded-2xl bg-slate-100 text-slate-400 flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
                            <i class="fa-solid fa-plus"></i>
                        </div>
                        <h3 class="text-lg font-bold text-slate-600 mb-2">More Courses Coming Soon</h3>
                        <p class="text-slate-500 text-sm">Stay tuned for advanced specializations.</p>
                    </div>
                </div>

            </div>

    </div>
</div>

<style>
    /* Custom Animations */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-fade-in-up {
        animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        opacity: 0;
        /* Start hidden */
    }
</style>
{% endblock %}