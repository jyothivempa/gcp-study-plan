{% extends 'base.html' %}
{% load markdown_extras %}

{% block title %}Search: {{ query }}{% endblock %}

{% block content %}
<div class="flex-1 bg-slate-50 overflow-y-auto">
    <div class="max-w-6xl mx-auto px-6 py-12">

        <!-- Header -->
        <div class="mb-10 text-center">
            <h1 class="text-3xl font-black text-slate-900 mb-2">Search Results</h1>
            <p class="text-slate-500">Found {{ results|length }} result{{ results|length|pluralize }} for "<span
                    class="font-bold text-brand-600">{{ query }}</span>"</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- LEFT COLUMN: RESULTS -->
            <div class="lg:col-span-8">
                {% if results %}
                <div class="space-y-6">
                    {% for day in results %}
                    <a href="{% url 'lesson_detail' day.week.course.slug day.number %}" class="block group">
                        <div
                            class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200 hover:shadow-md hover:border-brand-200 transition-all">
                            <div class="flex items-start justify-between">
                                <div>
                                    <div class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-1">
                                        Week {{ day.week.number }} â€¢ Day {{ day.number }}
                                    </div>
                                    <h2
                                        class="text-xl font-bold text-slate-800 group-hover:text-brand-600 transition-colors mb-2">
                                        {{ day.title }}
                                    </h2>
                                    <p class="text-sm text-slate-600 line-clamp-2">
                                        {{ day.description }}
                                    </p>
                                </div>
                                <div
                                    class="w-10 h-10 rounded-full bg-slate-50 text-slate-400 flex items-center justify-center group-hover:bg-brand-50 group-hover:text-brand-600 transition-colors">
                                    <i class="fa-solid fa-arrow-right"></i>
                                </div>
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-12 bg-white rounded-2xl border border-slate-200 border-dashed">
                    <div
                        class="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-6 text-slate-400 text-3xl">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-700 mb-2">No results found</h3>
                    <p class="text-slate-500 text-sm">Try searching for broader terms.</p>
                </div>
                {% endif %}
            </div>

            <!-- RIGHT COLUMN: ANALYTICS SIDEBAR -->
            <div class="lg:col-span-4 space-y-8">

                <!-- Popular Searches -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                    <h3 class="font-bold text-slate-900 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-fire text-orange-500"></i> Popular Searches
                    </h3>
                    <div class="flex flex-wrap gap-2">
                        {% for log in popular_searches %}
                        <a href="?q={{ log.query }}"
                            class="px-3 py-1 bg-slate-100 text-slate-600 text-sm rounded-full hover:bg-brand-50 hover:text-brand-600 transition">
                            {{ log.query }} <span class="text-xs text-slate-400 ml-1">{{ log.count }}</span>
                        </a>
                        {% empty %}
                        <p class="text-sm text-slate-400 italic">No data yet.</p>
                        {% endfor %}
                    </div>
                </div>

                <!-- Recent Searches (Authenticated) -->
                {% if user.is_authenticated %}
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                    <h3 class="font-bold text-slate-900 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-clock-rotate-left text-slate-400"></i> Your History
                    </h3>
                    <div class="space-y-2">
                        {% for log in recent_searches %}
                        <a href="?q={{ log.query }}"
                            class="block text-sm text-slate-600 hover:text-brand-600 transition flex justify-between">
                            <span>{{ log.query }}</span>
                            <span class="text-xs text-slate-400">{{ log.timestamp|timesince }} ago</span>
                        </a>
                        {% empty %}
                        <p class="text-sm text-slate-400 italic">No history yet.</p>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

            </div>
        </div>
    </div>
    {% endblock %}